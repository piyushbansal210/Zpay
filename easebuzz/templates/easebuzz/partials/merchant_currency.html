<div class="container-fluid mt-3 px-3">
  <!-- ====== PAGE HEADER ====== -->
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <h4 class="fw-semibold mb-0 text-dark">
      üí± Active Currency
    </h4>
    <button id="refreshBtn" class="btn btn-outline-primary btn-sm d-flex align-items-center gap-1">
      <i class="bi bi-arrow-clockwise"></i> Refresh
    </button>
  </div>

  <!-- ====== CARD ====== -->
  <div class="card border-0 shadow-sm rounded-3">
    <div class="card-body p-3">
      <h6 class="fw-semibold text-dark mb-3">Active Currency</h6>

      <!-- ====== TABLE ====== -->
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="bg-light text-muted small border-bottom">
            <tr>
              <th>Currency Name</th>
              <th>Origin</th>
              <th>Symbol</th>
              <th>PayOut</th>
              <th>PayIn</th>
            </tr>
          </thead>
          <tbody id="currencyTableBody">
            <tr>
              <td colspan="5" class="text-center py-4 text-muted">
                <div class="spinner-border spinner-border-sm text-primary me-2"></div>
                Loading currencies...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- ====== STYLES ====== -->
<style>
  body { background-color: #f8f9fc !important; }

  .btn-outline-primary {
    border-radius: 10px;
    font-size: 0.85rem;
    padding: 6px 12px;
    border: 1px solid #cbd5e1;
    color: #2563eb;
    background: #fff;
  }
  .btn-outline-primary:hover {
    background-color: #2563eb;
    color: #fff;
  }

  .status-active {
    color: #16a34a;
    font-weight: 600;
  }

  .status-inactive {
    color: #dc2626;
    font-weight: 600;
  }

  .empty-state {
    text-align: center;
    padding: 50px 0;
    color: #6b7280;
  }

  .empty-state i {
    font-size: 2.5rem;
    color: #9ca3af;
  }
</style>

<!-- ====== SCRIPT ====== -->
<script>
(function() {
  // This ensures the script runs even when loaded via HTMX or partial reload
  function initActiveCurrencyPage() {
    console.log("%cüåç Active Currency Page Loaded", "color: #2563eb; font-weight: bold;");

    const refreshBtn = document.getElementById("refreshBtn");
    const tableBody = document.getElementById("currencyTableBody");

    if (!tableBody) {
      console.warn("‚ö†Ô∏è currencyTableBody not found in DOM ‚Äî retrying...");
      setTimeout(initActiveCurrencyPage, 500);
      return;
    }

    // Initial load
    loadCurrencies();

    // Define the load function
    function loadCurrencies() {
      console.log("%cüîÅ Calling API: /easebuzz/active_currency/", "color: #10b981; font-weight: bold;");

      fetch("/easebuzz/active_currency/")
        .then(res => {
          console.log("%cüì° API Response Status:", "color: #f59e0b; font-weight: bold;", res.status);
          return res.json();
        })
        .then(data => {
          console.log("%c‚úÖ API Data Received:", "color: #16a34a; font-weight: bold;", data);

          const currencies = data.currencies || [];
          tableBody.innerHTML = "";

          if (!currencies.length) {
            console.warn("%c‚ö†Ô∏è No active currencies found", "color: #f87171; font-weight: bold;");
            showEmptyState();
            return;
          }

          currencies.forEach(c => {
            const name = c.currency_name || "‚Äî";
            const origin = c.origin || "‚Äî";
            const symbol = c.symbol || "‚Äî";
            const payout = c.payout_status === "Active" ? "Active" : "Inactive";
            const payin = c.payin_status === "Active" ? "Active" : "Inactive";

            tableBody.insertAdjacentHTML("beforeend", `
              <tr class="border-bottom">
                <td>${name}</td>
                <td>${origin}</td>
                <td>${symbol}</td>
                <td class="${payout === 'Active' ? 'status-active' : 'status-inactive'}">${payout}</td>
                <td class="${payin === 'Active' ? 'status-active' : 'status-inactive'}">${payin}</td>
              </tr>
            `);
          });
        })
        .catch(error => {
          console.error("%c‚ùå Error calling API:", "color: #dc2626; font-weight: bold;", error);
          showEmptyState();
        });
    }

    // Empty state
    function showEmptyState() {
      tableBody.innerHTML = `
        <tr>
          <td colspan="5" class="text-center">
            <div class="empty-state">
              <i class="bi bi-cash-stack"></i>
              <p class="fw-semibold mt-2 mb-2">No active currencies found</p>
              
            </div>
          </td>
        </tr>
      `;
      document.getElementById("retryBtn").addEventListener("click", () => {
        console.log("%cüîÅ Retry clicked ‚Äî reloading currencies", "color: #3b82f6; font-weight: bold;");
        loadCurrencies();
      });
    }

    // Refresh button handler
    if (refreshBtn) {
      refreshBtn.addEventListener("click", () => {
        console.log("%cüîÅ Refresh button clicked", "color: #3b82f6; font-weight: bold;");
        loadCurrencies();
      });
    }
  }

  // Run after DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initActiveCurrencyPage);
  } else {
    initActiveCurrencyPage();
  }
})();
</script>
