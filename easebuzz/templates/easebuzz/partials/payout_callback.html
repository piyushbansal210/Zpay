{% load static %}
<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <h5 class="mb-0 fw-semibold text-dark">Payout / <span class="text-success">Callback Details</span></h5>
    <div class="d-flex">
      <input id="pgRefInput" type="text" class="form-control form-control-sm me-2" placeholder="PG Ref">
      <button id="getReportBtn" class="btn btn-success btn-sm me-2"><i class="bi bi-download"></i> Get Report</button>
      <button id="refreshBtn" class="btn btn-outline-success btn-sm"><i class="bi bi-arrow-repeat"></i> Refresh Transaction</button>
    </div>
  </div>

  <div class="card p-3 shadow-sm bg-white rounded">
    <table class="table align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Pg Ref</th>
          <th>Payment Status</th>
          <th>Amount</th>
          <th>Transfer Type</th>
          <th>Updated At</th>
        </tr>
      </thead>
      <tbody id="callbackTableBody">
        <tr>
          <td colspan="5" class="text-center text-muted">No data found</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-center mt-3">
    <nav>
      <ul class="pagination pagination-sm">
        <li class="page-item disabled"><a class="page-link">&lt;</a></li>
        <li class="page-item active"><a class="page-link">1</a></li>
        <li class="page-item disabled"><a class="page-link">&gt;</a></li>
      </ul>
    </nav>
  </div>
</div>

<script>
document.getElementById("refreshBtn").addEventListener("click", fetchCallbacks);
document.getElementById("getReportBtn").addEventListener("click", fetchCallbacks);

function fetchCallbacks() {
  const pgRef = document.getElementById("pgRefInput").value.trim();
  const url = `/api/payout/callback_details/?pg_ref=${pgRef}`;
  
  fetch(url)
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("callbackTableBody");
      tbody.innerHTML = "";

      if (data.status === 1 && data.callbacks.length > 0) {
        data.callbacks.forEach(cb => {
          tbody.innerHTML += `
            <tr>
              <td>${cb.pg_ref || '-'}</td>
              <td>${cb.payment_status || '-'}</td>
              <td>${cb.amount || '-'}</td>
              <td>${cb.transfer_type || '-'}</td>
              <td>${cb.updated_at || '-'}</td>
            </tr>`;
        });
      } else {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">No data found</td></tr>';
      }
    })
    .catch(err => console.error("Error loading callbacks:", err));
}
</script>

