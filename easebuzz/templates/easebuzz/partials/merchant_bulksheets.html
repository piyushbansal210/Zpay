<div class="container-fluid mt-3 px-3">
  <!-- ====== PAGE HEADER ====== -->
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <h4 class="fw-semibold mb-0 text-dark">
      üìÑ All Bulk Sheets
    </h4>
    <div class="d-flex align-items-center gap-2">
      <div class="btn-group" role="group">
        <button type="button" id="adminBtn" class="btn btn-success btn-sm rounded-pill px-3">Admin</button>
        <button type="button" id="merchantBtn" class="btn btn-outline-secondary btn-sm rounded-pill px-3">Merchant</button>
      </div>
    </div>
  </div>

  <!-- ====== CARD ====== -->
  <div class="card border-0 shadow-sm rounded-3">
    <div class="card-body p-3">
      <h6 class="fw-semibold text-dark mb-3">All Bulk Sheets</h6>

      <!-- ====== TABLE ====== -->
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="bg-light text-muted small border-bottom">
            <tr>
              <th>Created At</th>
              <th>UserId</th>
              <th>Processed On</th>
              <th>Sheet</th>
            </tr>
          </thead>
          <tbody id="bulkSheetsTableBody">
            <!-- Populated by JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ====== PAGINATION ====== -->
  <div class="d-flex justify-content-end align-items-center mt-3 pe-3">
    <nav>
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item"><a class="page-link border-0 bg-light text-success" href="#"><i class="bi bi-chevron-left"></i></a></li>
        <li class="page-item active"><a class="page-link border-0 bg-success text-white" href="#">1</a></li>
        <li class="page-item"><a class="page-link border-0 bg-light text-success" href="#"><i class="bi bi-chevron-right"></i></a></li>
      </ul>
    </nav>
  </div>
</div>

<!-- ====== STYLES ====== -->
<style>
  body { background-color: #f8f9fc !important; }

  .btn-success {
    background-color: #7ED957 !important;
    border: none;
  }

  .btn-outline-secondary {
    background-color: #e9ecef !important;
    border: none;
    color: #555;
  }

  .empty-state {
    text-align: center;
    padding: 50px 0;
    color: #6b7280;
  }

  .empty-state i {
    font-size: 2.5rem;
    color: #9ca3af;
  }

  .table th {
    font-weight: 600;
  }

  .table td {
    color: #333;
  }
</style>

<!-- ====== SCRIPT ====== -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  console.log("%cüìÑ Bulk Sheets Page Loaded", "color:#16a34a;font-weight:bold;");

  const tableBody = document.getElementById("bulkSheetsTableBody");
  const adminBtn = document.getElementById("adminBtn");
  const merchantBtn = document.getElementById("merchantBtn");

  loadBulkSheets();

  adminBtn.addEventListener("click", () => toggleRole("admin"));
  merchantBtn.addEventListener("click", () => toggleRole("merchant"));

  function toggleRole(role) {
    if (role === "admin") {
      adminBtn.classList.add("btn-success");
      merchantBtn.classList.remove("btn-success");
      merchantBtn.classList.add("btn-outline-secondary");
      console.log("üîë Viewing Admin Bulk Sheets");
    } else {
      merchantBtn.classList.add("btn-success");
      adminBtn.classList.remove("btn-success");
      adminBtn.classList.add("btn-outline-secondary");
      console.log("üë§ Viewing Merchant Bulk Sheets");
    }
    loadBulkSheets(role);
  }

  function loadBulkSheets(role = "admin") {
    console.log("üîÅ Fetching Bulk Sheets for:", role);

    fetch("/easebuzz/all_bulk_sheets/")
      .then(res => res.json())
      .then(data => {
        console.log("‚úÖ API Data:", data);
        const sheets = data.sheets || [];
        tableBody.innerHTML = "";

        if (!sheets.length) {
          showEmptyState();
          return;
        }

        sheets.forEach(s => {
          const createdAt = s.created_at || "‚Äî";
          const userId = s.user_id || "‚Äî";
          const processedOn = s.processed_on || "‚Äî";
          const sheetUrl = s.sheet_url || "#";

          tableBody.insertAdjacentHTML("beforeend", `
            <tr class="border-bottom">
              <td>${createdAt}</td>
              <td>${userId}</td>
              <td>${processedOn}</td>
              <td>
                <a href="${sheetUrl}" target="_blank" class="btn btn-outline-primary btn-sm rounded-pill">
                  View Sheet
                </a>
              </td>
            </tr>
          `);
        });
      })
      .catch(error => {
        console.error("‚ùå Error fetching bulk sheets:", error);
        showEmptyState();
      });
  }

  function showEmptyState() {
    tableBody.innerHTML = `
      <tr>
        <td colspan="4" class="text-center">
          <div class="empty-state">
            <i class="bi bi-file-earmark-excel"></i>
            <p class="fw-semibold mt-2 mb-2">No bulk sheets found</p>
          </div>
        </td>
      </tr>
    `;
  }
});
</script>
