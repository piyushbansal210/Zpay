<div class="page">

  <!-- Header -->
  <div class="d-flex align-items-center justify-content-between mb-4">
    <div>
      <h3 class="fw-semibold mb-1" style="color: var(--text);">
        <i class="bi bi-person-fill-gear" style="color: var(--accent);"></i>
        Activate MID
      </h3>
      <p class="text-muted mb-0" style="font-size: 0.9rem;">Manage and activate acquirer MIDs</p>
    </div>
  </div>

  <!-- Filter Card -->
  <div class="card border-0 rounded-4 mb-4"
       style="background: var(--bg); border: 1px solid var(--stroke); box-shadow: var(--shadow);">
    <div class="card-body" style="padding: 20px;">

      <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">

        <!-- Pill Filters -->
        <div class="d-flex gap-2 flex-wrap" id="statusPills">
          <button class="pill-btn active" data-status="active">Active</button>
          <button class="pill-btn" data-status="hold">Hold</button>
          <button class="pill-btn" data-status="pending">Pending</button>
          <button class="pill-btn" data-status="inactive">Inactive</button>
        </div>

        <!-- Search -->
        <div class="position-relative">
          <i class="bi bi-search position-absolute"
             style="left: 14px; top: 50%; transform: translateY(-50%); color: var(--muted);"></i>
          <input type="text" id="searchBox"
                 class="form-control ps-5"
                 placeholder="Search by Acquirer or MID"
                 style="border: 1px solid var(--stroke); border-radius: 10px; padding: 10px 14px; background: var(--page); width: 260px;">
        </div>

      </div>

    </div>
  </div>

  <!-- Main Table Card -->
  <div class="card border-0 rounded-4"
       style="background: var(--bg); border: 1px solid var(--stroke); box-shadow: var(--shadow);">
    <div class="card-body" style="padding: 0;">

      <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
        <table class="table align-middle mb-0" style="border-collapse: separate; border-spacing: 0;">
          <thead style="background: var(--page); border-bottom: 2px solid var(--stroke); position: sticky; top: 0; z-index: 10;">
            <tr>
              <th class="th">Acquirer Name</th>
              <th class="th">MID</th>
              <th class="th">Txn Limit (Count)</th>
              <th class="th">Txn Limit (Value)</th>
              <th class="th">Remaining Count</th>
              <th class="th">Remaining Value</th>
              <th class="th text-end">More</th>
            </tr>
          </thead>

          <tbody id="activateRows">
            <tr>
              <td colspan="7" class="text-center py-5">
                <div class="spinner-border" style="color: var(--accent); width: 2rem; height: 2rem;"></div>
                <p class="mt-3 mb-0 text-muted">Loading MIDs...</p>
              </td>
            </tr>
          </tbody>

        </table>
      </div>

      <!-- Pagination -->
      <div class="d-flex justify-content-between align-items-center p-3 border-top"
           style="border-color: var(--stroke);" id="paginationSection">

        <small style="color: var(--muted); font-size: 0.875rem;">
          Showing page <span id="currentPage">1</span> of <span id="totalPages">1</span>
        </small>

        <div class="d-flex gap-2">
          <button id="prevPage" class="pagination-btn">
            <i class="bi bi-chevron-left"></i>
          </button>
          <button id="nextPage" class="pagination-btn active">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>

      </div>

    </div>
  </div>

</div>

<!-- Modern Styles -->
<style>
.pill-btn {
  padding: 8px 20px;
  background: var(--page);
  border: 1px solid var(--stroke);
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text);
  transition: all 0.2s ease;
}
.pill-btn:hover:not(.active) {
  background: #f2f2f2;
  transform: translateY(-1px);
}
.pill-btn.active {
  background: var(--accent);
  color: var(--accent-ink);
  border-color: var(--accent);
}

.th {
  padding: 16px 18px;
  color: var(--muted);
  font-weight: 600;
  font-size: 0.85rem;
  border: none;
}

.table tbody tr {
  transition: background 0.2s ease;
}
.table tbody tr:hover {
  background: var(--page);
}

.pagination-btn {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  border: 1px solid var(--stroke);
  background: var(--page);
  color: var(--text);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.2s ease;
}
.pagination-btn:hover:not(:disabled) {
  background: var(--accent);
  color: var(--accent-ink);
  border-color: var(--accent);
}
.pagination-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
</style>

<!-- JS -->
<script>
let currentPage = 1;
let totalPages = 1;

function loadMID(status = "active", search = "", page = 1) {
  const tbody = document.getElementById("activateRows");
  tbody.innerHTML = `
    <tr>
      <td colspan="7" class="text-center py-5">
        <div class="spinner-border" style="color: var(--accent); width: 2rem; height: 2rem;"></div>
        <p class="mt-3 mb-0 text-muted">Loading...</p>
      </td>
    </tr>
  `;

  fetch("/api/easebuzz/payin/master/activate-mid/", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ status, search, page })
  })
  .then(res => res.json())
  .then(data => {
    const rows = data.list || [];
    totalPages = data.total_pages || 1;
    currentPage = data.page || 1;

    document.getElementById("currentPage").textContent = currentPage;
    document.getElementById("totalPages").textContent = totalPages;

    if (!rows.length) {
      tbody.innerHTML = `
        <tr>
          <td colspan="7" class="text-center py-5 text-muted">
            <i class="bi bi-database-slash" style="font-size: 2rem; opacity: 0.3;"></i>
            <p class="mt-2">No MIDs found</p>
          </td>
        </tr>`;
      return;
    }

    tbody.innerHTML = rows.map(r => `
      <tr>
        <td>${r.acquirer_name}</td>
        <td>${r.mid}</td>
        <td>${r.transaction_limit_number}</td>
        <td>${r.transaction_limit_value}</td>
        <td>${r.remaining_transactions}</td>
        <td>${r.remaining_transaction_value}</td>
        <td class="text-end">
          <i class="bi bi-three-dots-vertical fs-5"></i>
        </td>
      </tr>
    `).join("");

    updatePaginationButtons();
  });
}

function updatePaginationButtons() {
  document.getElementById("prevPage").disabled = currentPage <= 1;
  document.getElementById("nextPage").disabled = currentPage >= totalPages;
}

/* Init */
document.addEventListener("DOMContentLoaded", () => {

  loadMID();

  /* Filter Pills */
  document.querySelectorAll(".pill-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".pill-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      loadMID(btn.dataset.status, document.getElementById("searchBox").value, 1);
    });
  });

  /* Search Bar */
  document.getElementById("searchBox").addEventListener("input", e => {
    const status = document.querySelector(".pill-btn.active").dataset.status;
    loadMID(status, e.target.value.trim(), 1);
  });

  /* Pagination */
  document.getElementById("prevPage").addEventListener("click", () => {
    if (currentPage > 1) {
      const status = document.querySelector(".pill-btn.active").dataset.status;
      loadMID(status, document.getElementById("searchBox").value, currentPage - 1);
    }
  });

  document.getElementById("nextPage").addEventListener("click", () => {
    if (currentPage < totalPages) {
      const status = document.querySelector(".pill-btn.active").dataset.status;
      loadMID(status, document.getElementById("searchBox").value, currentPage + 1);
    }
  });
});
</script>
